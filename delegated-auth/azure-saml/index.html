
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Guide for deploying Apereo CAS 6 - with LDAP & Delegated Azure Authentication, and Apache Tomcat.">
      
      
      
        <meta name="author" content="Paul Chauvet">
      
      
        <link rel="canonical" href="https://paulchauvet.github.io/deploying-cas/delegated-auth/azure-saml/">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>SAML method - Deploying Apereo CAS 6</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/newpaltz.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#delegated-authentication-to-azure-ad" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://paulchauvet.github.io/deploying-cas/" title="Deploying Apereo CAS 6" class="md-header-nav__button md-logo" aria-label="Deploying Apereo CAS 6">
      
  <img src="../../images/newpaltz-logo.jpg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Deploying Apereo CAS 6
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              SAML method
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://paulchauvet.github.io/deploying-cas/" title="Deploying Apereo CAS 6" class="md-nav__button md-logo" aria-label="Deploying Apereo CAS 6">
      
  <img src="../../images/newpaltz-logo.jpg" alt="logo">

    </a>
    Deploying Apereo CAS 6
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Main
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        About
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/about-new-paltz/" class="md-nav__link">
        About SUNY New Paltz
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/author-information/" class="md-nav__link">
        About the author
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/architecture/" class="md-nav__link">
        Architecture/design
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/acknowledgements/" class="md-nav__link">
        Acknowledgements
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Setting up the Environment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Setting up the Environment" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Setting up the Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/time-synchronization/" class="md-nav__link">
        Configure time synchronization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/build-environment/" class="md-nav__link">
        Build Environment
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" >
      
      <label class="md-nav__link" for="nav-3-4">
        Tomcat
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tomcat" data-md-level="2">
        <label class="md-nav__title" for="nav-3-4">
          <span class="md-nav__icon md-icon"></span>
          Tomcat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/tomcat-overview/" class="md-nav__link">
        Tomcat Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/entropy-daemon/" class="md-nav__link">
        Install an entropy daemon
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/java/" class="md-nav__link">
        Install Java
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/tomcat-install/" class="md-nav__link">
        Install Tomcat
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/tomcat-dependencies/" class="md-nav__link">
        Install Tomcat dependencies
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/tomcat-organize/" class="md-nav__link">
        Organize the installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/tomcat-harden/" class="md-nav__link">
        Harden the installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/asynch-request-support/" class="md-nav__link">
        Configure asynchronous request support
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/config-x-forwarded/" class="md-nav__link">
        Configure X-Forwarded-For header processing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/resource-caching/" class="md-nav__link">
        Tune resource caching settings
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/configure-async-logging/" class="md-nav__link">
        Configure asynchronous logging support
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat/systemd-service/" class="md-nav__link">
        Configure systemd to start tomcat
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5" >
      
      <label class="md-nav__link" for="nav-3-5">
        Tomcat and Ansible
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tomcat and Ansible" data-md-level="2">
        <label class="md-nav__title" for="nav-3-5">
          <span class="md-nav__icon md-icon"></span>
          Tomcat and Ansible
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/tomcat-ansible-overview/" class="md-nav__link">
        Ansible and Tomcat - Initial Steps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/variables/" class="md-nav__link">
        Setup Variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/templates/" class="md-nav__link">
        Setup Templates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/handlers/" class="md-nav__link">
        Setup Handlers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/tasks/" class="md-nav__link">
        Creating tasks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/tomcat-ansible/running-the-play/" class="md-nav__link">
        Running the play
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6" >
      
      <label class="md-nav__link" for="nav-3-6">
        Apache HTTPD
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Apache HTTPD" data-md-level="2">
        <label class="md-nav__title" for="nav-3-6">
          <span class="md-nav__icon md-icon"></span>
          Apache HTTPD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up-the-environment/httpd/ajp-proxy/" class="md-nav__link">
        Use AJP to communicate with Tomcat
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        Building CAS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Building CAS" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Building CAS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../building-cas/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../building-cas/create-gradle-overlay/" class="md-nav__link">
        Create Gradle Overlay
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../building-cas/initial-cas-config/" class="md-nav__link">
        Initial CAS config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../building-cas/cas-log-config/" class="md-nav__link">
        Configure CAS logs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../building-cas/ansible-cas/" class="md-nav__link">
        Ansible playbook setup
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        Service Configuration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Service Configuration" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Service Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../service-config/overview/" class="md-nav__link">
        Service Overview
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        Building CAS client
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Building CAS client" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          Building CAS client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cas-client/overview/" class="md-nav__link">
        CAS client overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cas-client/cas-client-pages/" class="md-nav__link">
        Create test/example pages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cas-client/build-cas-client/" class="md-nav__link">
        Configure httpd to use CAS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cas-client/test-cas-client/" class="md-nav__link">
        Test the application
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        Adding AD support
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Adding AD support" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          Adding AD support
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/configure-ldap-auth/" class="md-nav__link">
        AD authentication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/ad-attribute-release/" class="md-nav__link">
        AD attribute release
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/update-service-registry/" class="md-nav__link">
        Update service registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/update-cas-client/" class="md-nav__link">
        Update CAS client
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../active-directory/test-cas-client/" class="md-nav__link">
        Test CAS client
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        Duo MFA support
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Duo MFA support" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          Duo MFA support
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../duo-mfa/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../duo-mfa/update-cas-client/" class="md-nav__link">
        Update CAS client
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../duo-mfa/testing-mfa/" class="md-nav__link">
        Test Duo MFA
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        Ticket Registry
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Ticket Registry" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          Ticket Registry
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ticket-registry/hazelcast-overview/" class="md-nav__link">
        Hazelcast Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ticket-registry/testing-ticket-registry/" class="md-nav__link">
        Testing Ticket Registry
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
      
      <label class="md-nav__link" for="nav-10">
        Delegating auth to Azure
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Delegating auth to Azure" data-md-level="1">
        <label class="md-nav__title" for="nav-10">
          <span class="md-nav__icon md-icon"></span>
          Delegating auth to Azure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SAML method
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SAML method
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-an-application-in-azure-ad" class="md-nav__link">
    Setup an application in Azure AD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-saml-properties-in-cas" class="md-nav__link">
    Configure SAML properties in CAS
  </a>
  
    <nav class="md-nav" aria-label="Configure SAML properties in CAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azure-saml-settings" class="md-nav__link">
    Azure SAML settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-setup" class="md-nav__link">
    Variable setup
  </a>
  
    <nav class="md-nav" aria-label="Variable setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-to-get-these-values" class="md-nav__link">
    Where to get these values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-only-one-cas-server" class="md-nav__link">
    Deploy to ONLY ONE CAS server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributing-these-files-via-ansible" class="md-nav__link">
    Distributing these files via Ansible
  </a>
  
    <nav class="md-nav" aria-label="Distributing these files via Ansible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-keypemkeystore-files" class="md-nav__link">
    Encrypt the key/pem/keystore files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-ansible-task-to-push-those-files-out" class="md-nav__link">
    Create an Ansible task to push those files out
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rerun-the-playbook" class="md-nav__link">
    Rerun the playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finish-azure-config" class="md-nav__link">
    Finish Azure config
  </a>
  
    <nav class="md-nav" aria-label="Finish Azure config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-cas-metadata-to-azure" class="md-nav__link">
    Upload CAS metadata to Azure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../azure-oidc-incomplete/" class="md-nav__link">
        OIDC (incomplete)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        Testing Delegated Auth
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../azure-conditional/overview/" class="md-nav__link">
        Azure Conditional Access
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../theming/overview/" class="md-nav__link">
        Themes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../final-setup/overview/" class="md-nav__link">
        Final tasks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/future-tasks/" class="md-nav__link">
        Future tasks
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-an-application-in-azure-ad" class="md-nav__link">
    Setup an application in Azure AD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-saml-properties-in-cas" class="md-nav__link">
    Configure SAML properties in CAS
  </a>
  
    <nav class="md-nav" aria-label="Configure SAML properties in CAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azure-saml-settings" class="md-nav__link">
    Azure SAML settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-setup" class="md-nav__link">
    Variable setup
  </a>
  
    <nav class="md-nav" aria-label="Variable setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-to-get-these-values" class="md-nav__link">
    Where to get these values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-only-one-cas-server" class="md-nav__link">
    Deploy to ONLY ONE CAS server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributing-these-files-via-ansible" class="md-nav__link">
    Distributing these files via Ansible
  </a>
  
    <nav class="md-nav" aria-label="Distributing these files via Ansible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-keypemkeystore-files" class="md-nav__link">
    Encrypt the key/pem/keystore files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-ansible-task-to-push-those-files-out" class="md-nav__link">
    Create an Ansible task to push those files out
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rerun-the-playbook" class="md-nav__link">
    Rerun the playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finish-azure-config" class="md-nav__link">
    Finish Azure config
  </a>
  
    <nav class="md-nav" aria-label="Finish Azure config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-cas-metadata-to-azure" class="md-nav__link">
    Upload CAS metadata to Azure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="delegated-authentication-to-azure-ad">Delegated Authentication to Azure AD</h1>
<div class="admonition note">
<p class="admonition-title">Optional Content</p>
<p>This is all optional.  If you don't need to delegate authentication to Azure and all of your authentication will be against an on-prem Active Directory or other LDAP/DB, then you can skip this section.</p>
</div>
<h2 id="setup-an-application-in-azure-ad">Setup an application in Azure AD</h2>
<p>Azure Active Directory needs to have an application registered in order for CAS to delegate authentications to it.  This is all done via the <a href="https://aad.portal.azure.com">Azure AD portal</a>.</p>
<ol>
<li>Go to the <a href="https://aad.portal.azure.com">Azure AD portal</a>.</li>
<li>Click <em>Enterprise Applications</em>.</li>
<li>At the top, click <em>New application</em> then <em>Create your own application</em> near the top left.</li>
<li>Select <em>Integrate any other application you don't find in the gallery (Non-gallery)</em>, then give your app a name.  This name is, at least by default, user visible (depending on where users look) so I recommend something clear like <em>"Your School Login-Dev"</em>, <em>"Your School Login-Test"</em> or <em>"Your School Login"</em> (for prod).</li>
<li>Click Users and groups on the left.  Use this section to add any users or groups who need access - though you may want to start with one or more test users.</li>
<li>Click <em>Single sign-on</em> on the left, then SAML.</li>
<li>Copy the <em>App Federation Metadata URL</em> - you'll need this for the DEV_AZURE_METADATA_PATH later.</li>
</ol>
<p>We're not done here yet - but need to do a few other things before we can finish - notably setting up the CAS side and the metadata there.</p>
<div class="admonition note">
<p class="admonition-title">Note regarding application names</p>
<p>I'd recommend not having a spaces or crazy special characters in the app name.  I have only tested with alphanumeric characters along with hypnens in the client name.  I don't know what Azure would allow, but would cause issues with CAS, or CAS clients, etc, but I haven't had a reason to find out.  Stick with the basics.</p>
</div>
<h2 id="configure-saml-properties-in-cas">Configure SAML properties in CAS</h2>
<p>Add the following settings to roles/cas6/templates/dev-cas.properties.j2 in the cas-overlay-template directory on your Ansible server.  As with other sections - we're going to use variables here since some of these properties are sensitive, and we'll leave them as variables here (and the real values will be in the Ansible cas-vault.yml file).</p>
<h3 id="azure-saml-settings">Azure SAML settings</h3>
<p><strong>roles/cas6/templates/dev-cas-properties.j2:</strong>
<div class="highlight"><pre><span></span><code><span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.keys</span><span class="kc">t</span><span class="err">orePassword=</span><span class="p">{{</span> <span class="err">DEV_KEYSTORE_PASSWORD</span> <span class="p">}}</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.priva</span><span class="kc">te</span><span class="err">KeyPassword=</span><span class="p">{{</span> <span class="err">DEV_SAML_KEY_PASSWORD</span> <span class="p">}}</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.keys</span><span class="kc">t</span><span class="err">orePa</span><span class="kc">t</span><span class="err">h=/e</span><span class="kc">t</span><span class="err">c/cas/co</span><span class="kc">nf</span><span class="err">ig/samlKeys</span><span class="kc">t</span><span class="err">ore.jks</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.serviceProviderE</span><span class="kc">nt</span><span class="err">i</span><span class="kc">t</span><span class="err">yId=</span><span class="p">{{</span> <span class="err">DEV_SAML_ENTITY_ID</span> <span class="p">}}</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.serviceProviderMe</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">Pa</span><span class="kc">t</span><span class="err">h=/e</span><span class="kc">t</span><span class="err">c/cas/co</span><span class="kc">nf</span><span class="err">ig/sp</span><span class="mi">-</span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">.xml</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.ide</span><span class="kc">nt</span><span class="err">i</span><span class="kc">t</span><span class="err">yProviderMe</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">Pa</span><span class="kc">t</span><span class="err">h=</span><span class="p">{{</span> <span class="err">DEV_AZURE_METADATA_PATH</span> <span class="p">}}</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.clie</span><span class="kc">nt</span><span class="err">Name=</span><span class="p">{{</span> <span class="err">DEV_AZURE_APP_NAME</span> <span class="p">}}</span>
<span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.use</span><span class="mi">-</span><span class="kc">na</span><span class="err">me</span><span class="mi">-</span><span class="err">quali</span><span class="kc">f</span><span class="err">ier=</span><span class="kc">false</span>
<span class="err">#</span> <span class="err">cas.au</span><span class="kc">t</span><span class="err">h</span><span class="kc">n</span><span class="err">.pac</span><span class="mi">4</span><span class="err">j.saml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.au</span><span class="kc">t</span><span class="err">oRedirec</span><span class="kc">t</span><span class="err">=</span><span class="kc">true</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Automatic redirect</p>
<p>Once you are done testing - if you ONLY want to delegate authentication (i.e. no local AD or LDAP auth) you
may want to use the autoRedirect setting that I have commented out above.
This will cause anyone who goes to CAS (either directly or via a redirect from a service) to be automatically redirected to the specified external identity provider.</p>
</div>
<h3 id="variable-setup">Variable setup</h3>
<p>Edit your <em>cas-vault.yml</em> file within <em>roles/cas6/vars/</em></p>
<p>You'll need to add the following:</p>
<div class="highlight"><pre><span></span><code><span class="err">DEV_KEYSTORE_PASSWORD</span><span class="p">:</span> <span class="err">SomeS</span><span class="kc">tr</span><span class="err">o</span><span class="kc">n</span><span class="err">gPasswordImSure</span>
<span class="err">DEV_SAML_KEY_PASSWORD</span><span class="p">:</span> <span class="err">SomeO</span><span class="kc">t</span><span class="err">herS</span><span class="kc">tr</span><span class="err">o</span><span class="kc">n</span><span class="err">gPassword</span>
<span class="err">DEV_SAML_ENTITY_ID</span><span class="p">:</span> <span class="err">ur</span><span class="kc">n</span><span class="p">:</span><span class="err">mace</span><span class="p">:</span><span class="err">saml</span><span class="p">:</span><span class="err">pac</span><span class="mi">4</span><span class="err">j</span><span class="p">:</span><span class="err">org</span>
<span class="err">DEV_AZURE_APP_NAME</span><span class="p">:</span> <span class="err">Your</span> <span class="err">School</span><span class="mi">-</span><span class="err">Dev</span>
<span class="err">DEV_AZURE_METADATA_PATH</span><span class="p">:</span> <span class="err">h</span><span class="kc">tt</span><span class="err">ps</span><span class="p">:</span><span class="err">//logi</span><span class="kc">n</span><span class="err">.microso</span><span class="kc">ft</span><span class="err">o</span><span class="kc">nl</span><span class="err">i</span><span class="kc">ne</span><span class="err">.com/&lt;some</span><span class="mi">-</span><span class="kc">tenant</span><span class="mi">-</span><span class="err">speci</span><span class="kc">f</span><span class="err">ic</span><span class="mi">-</span><span class="err">i</span><span class="kc">nf</span><span class="err">o&gt;/</span><span class="kc">fe</span><span class="err">dera</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">/</span><span class="mi">2007-06</span><span class="err">/</span><span class="kc">fe</span><span class="err">dera</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">.xml?appid=&lt;some</span><span class="mi">-</span><span class="err">app</span><span class="mi">-</span><span class="err">speci</span><span class="kc">f</span><span class="err">ic</span><span class="mi">-</span><span class="err">i</span><span class="kc">nf</span><span class="err">o&gt;</span>
</code></pre></div>
<h4 id="where-to-get-these-values">Where to get these values</h4>
<ul>
<li>DEV_KEYSTORE_PASSWORD: This is a password you choose to protect your SAML keystore</li>
<li>DEV_SAML_KEY_PASSWORD: This is a password you choose to protect your SAML private key</li>
<li>DEV_SAML_ENTITY_ID: This is unique and cannot be reused in more than one app in Azure.  The 'sample' entity id is <em>urn:mace:saml:pac4j.org</em>.  You may want to use something like <em>urn:mace:saml:dev.yourdomain.edu</em>.</li>
<li>DEV_AZURE_APP_NAME: This is the name you gave the application in step 4 of <em>Setup an application in Azure AD</em>.</li>
<li>DEV_AZURE_METADATA_PATH: This is from step 7 of <em>Setup an application in Azure AD</em>.</li>
</ul>
<h2 id="deploy-to-only-one-cas-server">Deploy to ONLY ONE CAS server</h2>
<p>You need to deploy this to one CAS server only to start.  In order for the files below to be created (if they don't exist already) you have to start CAS - and then visit the CAS page in a browser.  If you deploy to more than one it's not a huge deal - but you'll want to make sure the files below are the same in each tier (i.e. all of your prod tier has the same files, all of your dev tier has the same files, etc.).</p>
<ul>
<li>samlKeystore.jks</li>
<li>sp-metadata.xml</li>
<li>saml-signing-cert-<YOUR-APP-NAME>.crt</li>
<li>saml-signing-cert-<YOUR-APP-NAME>.pem</li>
<li>saml-signing-cert-<YOUR-APP-NAME>.key</li>
</ul>
<h2 id="distributing-these-files-via-ansible">Distributing these files via Ansible</h2>
<p>Optional of course - but if you don't do it via Ansible you'll have to make sure some other way that these are the same on a tier.</p>
<h3 id="encrypt-the-keypemkeystore-files">Encrypt the key/pem/keystore files</h3>
<ul>
<li>Copy the five files listed above to your ansible/roles/cas6/files directory</li>
<li>rename samlKeystore.jks to samlKeystore-DEV.jks (<em>or some other indication that it's the dev store</em>)</li>
<li>rename sp-metadata.xml to sp-metadata-DEV.xml (<em>or some other indication that it's the dev store</em>)</li>
<li>In that directory type the following:</li>
</ul>
<div class="highlight"><pre><span></span><code>ansible-vault encrypt saml-signing-cert-YourSchoolLogin-DEV.key saml-signing-cert-YourSchoolLogin-DEV.pem samlKeystore-DEV.jks
</code></pre></div>
<h3 id="create-an-ansible-task-to-push-those-files-out">Create an Ansible task to push those files out</h3>
<p>First update main.yml and include a reference to a new sub-task:</p>
<p><strong>roles/cas6/tasks/main.yml:</strong>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debug.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">base-cas-config.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cas-ajp-proxy.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service-config.yml</span>
<span class="hll"><span class="p p-Indicator">-</span> <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">push-saml-files.yml</span>
</span></code></pre></div></p>
<p>**roles/cas6/tasks/push-saml-files.yml
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">include_vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cas-vault.yml</span>

<span class="c1"># Note: These are for dev specifically.  If we have multiple environments, there&#39;s</span>
<span class="c1"># will be different keystores, certificates, metadata, etc., for each host.</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure saml-signing-cert .crt file (DEV) is up-to-date</span>
  <span class="nt">ansible.builtin.copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">saml-signing-cert-YourSchoolLogin-DEV.crt</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/cas/config/saml-signing-cert-YourSchoolLogin-DEV.crt</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>        
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(&quot;login6dev&quot; in inventory_hostname)</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tomcat</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure saml-signing-cert .key file (DEV) is up-to-date</span>
  <span class="nt">ansible.builtin.copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">saml-signing-cert-YourSchoolLogin-DEV.key</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/cas/config/saml-signing-cert-YourSchoolLogin-DEV.key</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>    
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(&quot;login6dev&quot; in inventory_hostname)</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tomcat</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure saml-signing-cert .pem file (DEV) is up-to-date</span>
  <span class="nt">ansible.builtin.copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">saml-signing-cert-YourSchoolLogin-DEV.pem</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/cas/config/saml-signing-cert-YourSchoolLogin-DEV.pem</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>    
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(&quot;login6dev&quot; in inventory_hostname)</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tomcat</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure sp-metadata.xml (DEV) is up-to-date</span>
  <span class="nt">ansible.builtin.copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sp-metadata-DEV.xml</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/cas/config/sp-metadata.xml</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(&quot;login6dev&quot; in inventory_hostname)</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>    
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tomcat</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure samlKeystore.jks (DEV) is up-to-date</span>
  <span class="nt">ansible.builtin.copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">samlKeystore-DEV.jks</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/cas/config/samlKeystore.jks</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tomcat</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(&quot;login6dev&quot; in inventory_hostname)</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>    
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tomcat</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Why the ignore_errors setting?</p>
<p>This is the only place so far that the 'ignore_errors' is used - and it's used for all the tasks here.  You may be wondering why?</p>
<p>The reason for this - is that when the CAS6 playbook is first being run - those files will not exist.  You'll run this on one server, start up CAS, and go to the CAS login page.  That will cause these files (samlKeystore.jks, sp-metadata.xml, and the various saml-signing-certs) to be created.  Once you have them created on one host in a tier, you can copy them from that host to your Ansible files directory (and encrypt them if you're going to have them in git)</p>
</div>
<h2 id="rerun-the-playbook">Rerun the playbook</h2>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">chauvetp@ansible templates</span><span class="p p-Indicator">]</span><span class="l l-Scalar l-Scalar-Plain">$ ansible-playbook ~/ansible/site.yml --ask-vault-pass --limit &lt;your_CAS_server&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">Vault password</span><span class="p p-Indicator">:</span> 
</code></pre></div>
<h2 id="finish-azure-config">Finish Azure config</h2>
<p>There's a few remaining things to do in Azure.</p>
<h3 id="upload-cas-metadata-to-azure">Upload CAS metadata to Azure</h3>
<ul>
<li>Have the sp-metadata.xml file available from CAS then go back to the application you created earlier in Azure (Azure AAD -&gt; Enterprise Applications -&gt; Search for your app)</li>
<li>Go to the Single sign-on tab</li>
<li>Click <em>Upload metadata file</em> near the top and navigate to the sp-metadata.xml file then click <em>Add</em> then <em>Save</em></li>
<li>Optional: Within the Properties section - you may want to set "Visible to Users" to <em>no</em>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Environment specific</p>
<p>This is highly dependent on your own environment!  In my environment this takes my userPrincipalName (chauvetp@newpaltz.edu) and transforms it to just chauvetp (ExtractMailPrefix takes the part before the @ sign).</p>
</div>
<p>If your environment is like ours (and it may not be!) - your cas applications want to see a person's username - not their full email address or userPrincipalName as the 'cas user'.  You can do a transformation within Azure to make this happen.</p>
<ul>
<li>Go to the Single Sign On section of your app in Azure again (Azure AD -&gt; Enterprise Applications -&gt; Your application).</li>
<li>In section 2, <em>User Attributes &amp; Claims</em>, click <em>Edit</em>.</li>
<li>In the Required claim section, click on the existing claim.</li>
<li>Change <em>Name identifier format</em> from <em>Email address</em> (which is the default in Azure) to just <em>default</em></li>
<li>Change <em>Source</em> from <em>Attribute</em> to <em>Transformation</em></li>
<li>Set <em>Transformation</em> to <em>ExtractMailPrefix()</em></li>
<li>Set <em>Parameter 1</em> to <em>user.userprincipalname</em></li>
<li>Click <em>Add</em> at the bottom, then <em>Save</em></li>
</ul>
<h2 id="references">References</h2>
<p><a href="https://apereo.github.io/cas/6.3.x/integration/Delegate-Authentication.html#delegated-authentication">CAS 6: Delegated Authentication</a>
<a href="https://apereo.github.io/cas/6.3.x/integration/Delegate-Authentication-SAML.html#delegated-authentication-w-saml2">CAS 6: Delegated Authentication with SAML2</a>
<a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html#encrypting-files-with-ansible-vault">Encrypting content with Ansible vault</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../overview/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </div>
            </div>
          </a>
        
        
          <a href="../azure-oidc-incomplete/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                OIDC (incomplete)
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Paul Chauvet, State University of New York at New Paltz.  This work is licensed under a "Creative Commons Attribution-ShareAlike 4.0 International License"
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>